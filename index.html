<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Transparent Highlighter â€“ Storyline Fit</title>
<style>
  :root { --toolbar-h: 54px; }

  * { box-sizing: border-box; }
  html, body { height: 100%; margin: 0; }

  body{
    overflow:hidden;
    background: transparent; /* important inside Storyline */
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  }

  /* Toolbar */
  .toolbar{
    position: absolute;
    top: 0; left: 0; right: 0;
    height: var(--toolbar-h);
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: rgba(255,255,255,0.95);
    border-bottom: 1px solid #e4e4e4;
    z-index: 10;
  }

  button{
    padding: 6px 10px;
    border: 1px solid #cfcfcf;
    border-radius: 8px;
    background: #fff;
    cursor: pointer;
    font-size: 14px;
  }
  button.active{
    border-color:#333;
    box-shadow: inset 0 0 0 2px #3332;
  }

  /* Viewport = whatever Storyline gives the Web Object */
  .viewport{
    position: absolute;
    inset: 0;
    overflow: hidden;
    background: transparent;
  }

  /* Content area below toolbar */
  .content{
    position: absolute;
    top: var(--toolbar-h);
    left: 0; right: 0; bottom: 0;
    overflow: hidden;
  }

  /* A scalable wrapper we can transform */
  .stageWrap{
    position: absolute;
    left: 50%;
    top: 0;
    transform-origin: top center;
  }

  /* The fixed "design size" stage */
  .stage{
    position: relative;
    width: 1276px;
    height: 1790px;
    overflow: hidden;
    background: transparent;
  }

  .page{
    position: absolute;
    inset: 0;
    background: url("S5U7L1-01.png") no-repeat center top;
    background-size: contain;
    z-index: 0;
  }

  /* Canvas uses design size, scaled with the wrapper */
  canvas{
    position: absolute;
    inset: 0;
    width: 1276px;
    height: 1790px;
    background: transparent;
    z-index: 1;
    touch-action: none;
  }
</style>
</head>

<body>
  <div class="viewport">
    <div class="toolbar">
      <button id="penBtn" class="active">Pen</button>
      <button id="hlBtn">Highlighter</button>
      <button id="eraserBtn">Eraser</button>
      <button id="clearBtn">Clear</button>
    </div>

    <div class="content" id="content">
      <div class="stageWrap" id="stageWrap">
        <div class="stage" id="stage">
          <div class="page"></div>
          <canvas id="board" width="1276" height="1790"></canvas>
        </div>
      </div>
    </div>
  </div>

<script>
  // ====== DESIGN SIZE (Storyline slide) ======
  const DESIGN_W = 1276;
  const DESIGN_H = 1790;

  const content   = document.getElementById("content");
  const stageWrap = document.getElementById("stageWrap");
  const canvas    = document.getElementById("board");
  const ctx       = canvas.getContext("2d");

  const penBtn    = document.getElementById("penBtn");
  const hlBtn     = document.getElementById("hlBtn");
  const eraserBtn = document.getElementById("eraserBtn");
  const clearBtn  = document.getElementById("clearBtn");

  let mode = "pen";
  let drawing = false;

  // current scale applied to the wrapper
  let scale = 1;

  function fitStage(){
    const cw = content.clientWidth;
    const ch = content.clientHeight;

    // scale stage to fit within available area while preserving aspect ratio
    scale = Math.min(cw / DESIGN_W, ch / DESIGN_H);

    // center horizontally, top aligned
    stageWrap.style.transform = `translateX(-50%) scale(${scale})`;
    stageWrap.style.width = DESIGN_W + "px";
    stageWrap.style.height = DESIGN_H + "px";
  }

  window.addEventListener("resize", fitStage);
  fitStage();

  function setMode(m){
    mode = m;
    penBtn.classList.toggle("active", m === "pen");
    hlBtn.classList.toggle("active", m === "highlighter");
    eraserBtn.classList.toggle("active", m === "eraser");
  }

  // Drawing style
  ctx.lineCap = "round";
  ctx.lineJoin = "round";

  function getPoint(e){
    // Get pointer in *design coordinates* (1276x1790)
    const rect = canvas.getBoundingClientRect();

    let clientX, clientY;
    if (e.touches && e.touches[0]){
      clientX = e.touches[0].clientX;
      clientY = e.touches[0].clientY;
    } else {
      clientX = e.clientX;
      clientY = e.clientY;
    }

    const xCss = clientX - rect.left;
    const yCss = clientY - rect.top;

    // rect is already scaled; map back to design coordinates:
    const x = xCss / scale;
    const y = yCss / scale;

    return { x, y };
  }

  function start(e){
    drawing = true;
    ctx.beginPath();
    const {x,y} = getPoint(e);
    ctx.moveTo(x,y);
  }

  function draw(e){
    if(!drawing) return;

    if(mode === "pen"){
      ctx.globalCompositeOperation = "source-over";
      ctx.lineWidth = 2.5;
      ctx.strokeStyle = "#111";
    } else if(mode === "highlighter"){
      ctx.globalCompositeOperation = "multiply";
      ctx.lineWidth = 18;
      ctx.strokeStyle = "rgba(255,255,0,0.15)";
    } else if(mode === "eraser"){
      ctx.globalCompositeOperation = "destination-out";
      ctx.lineWidth = 22;
      ctx.strokeStyle = "rgba(0,0,0,1)";
    }

    const {x,y} = getPoint(e);
    ctx.lineTo(x,y);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x,y);
  }

  function end(){
    drawing = false;
    ctx.beginPath();
    ctx.globalCompositeOperation = "source-over";
  }

  // Mouse
  canvas.addEventListener("mousedown", start);
  canvas.addEventListener("mousemove", draw);
  window.addEventListener("mouseup", end);

  // Touch
  canvas.addEventListener("touchstart", (e)=>{ e.preventDefault(); start(e); }, {passive:false});
  canvas.addEventListener("touchmove",  (e)=>{ e.preventDefault(); draw(e);  }, {passive:false});
  canvas.addEventListener("touchend",   (e)=>{ e.preventDefault(); end();    }, {passive:false});

  // Buttons
  penBtn.onclick    = ()=>setMode("pen");
  hlBtn.onclick     = ()=>setMode("highlighter");
  eraserBtn.onclick = ()=>setMode("eraser");
  clearBtn.onclick  = ()=>ctx.clearRect(0,0,DESIGN_W,DESIGN_H);

  setMode("pen");
</script>
</body>
</html>
